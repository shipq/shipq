/* Stoplight Elements JS - Vendored Version */
/* This is a placeholder for the actual @stoplight/elements JS bundle */
/* In production, replace with: https://unpkg.com/@stoplight/elements/web-components.min.js */

(function () {
  'use strict';

  // Define the custom element for Stoplight Elements API viewer
  class ElementsAPI extends HTMLElement {
    constructor() {
      super();
      this.attachShadow({ mode: 'open' });
    }

    connectedCallback() {
      const apiDescriptionUrl = this.getAttribute('apiDescriptionUrl') || '';
      const router = this.getAttribute('router') || 'hash';
      const layout = this.getAttribute('layout') || 'sidebar';

      this.shadowRoot.innerHTML = `
                <style>
                    :host {
                        display: block;
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        padding: 20px;
                        min-height: 100vh;
                        box-sizing: border-box;
                    }
                    .container {
                        max-width: 1200px;
                        margin: 0 auto;
                    }
                    h1 {
                        color: #1f2937;
                        margin-bottom: 10px;
                    }
                    .info {
                        background: #f3f4f6;
                        border-radius: 8px;
                        padding: 20px;
                        margin-bottom: 20px;
                    }
                    .loading {
                        color: #6b7280;
                        font-style: italic;
                    }
                    .api-content {
                        background: #ffffff;
                        border: 1px solid #e5e7eb;
                        border-radius: 8px;
                        padding: 20px;
                    }
                    pre {
                        background: #1f2937;
                        color: #f9fafb;
                        padding: 15px;
                        border-radius: 6px;
                        overflow-x: auto;
                        font-size: 14px;
                    }
                    .endpoint {
                        margin: 10px 0;
                        padding: 10px;
                        background: #f9fafb;
                        border-radius: 4px;
                        border-left: 4px solid #3b82f6;
                    }
                    .method {
                        display: inline-block;
                        padding: 2px 8px;
                        border-radius: 4px;
                        font-weight: bold;
                        font-size: 12px;
                        margin-right: 10px;
                    }
                    .method-get { background: #10b981; color: white; }
                    .method-post { background: #3b82f6; color: white; }
                    .method-put { background: #f59e0b; color: white; }
                    .method-delete { background: #ef4444; color: white; }
                    .method-patch { background: #8b5cf6; color: white; }
                    .path { font-family: monospace; }
                </style>
                <div class="container">
                    <h1>API Documentation</h1>
                    <div class="info">
                        <p><strong>OpenAPI Specification:</strong> <a href="${apiDescriptionUrl}" target="_blank">${apiDescriptionUrl}</a></p>
                        <p><strong>Router:</strong> ${router} | <strong>Layout:</strong> ${layout}</p>
                    </div>
                    <div class="api-content">
                        <p class="loading">Loading API specification...</p>
                    </div>
                </div>
            `;

      // Fetch and display the OpenAPI spec
      if (apiDescriptionUrl) {
        this.loadSpec(apiDescriptionUrl);
      }
    }

    async loadSpec(url) {
      const contentEl = this.shadowRoot.querySelector('.api-content');
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        const spec = await response.json();
        this.renderSpec(spec, contentEl);
      } catch (error) {
        contentEl.innerHTML = `<p style="color: #ef4444;">Error loading API specification: ${error.message}</p>`;
      }
    }

    renderSpec(spec, container) {
      const info = spec.info || {};
      const paths = spec.paths || {};

      let html = `
                <h2>${info.title || 'API'} <small style="color:#6b7280">v${info.version || '0.0.0'}</small></h2>
                ${info.description ? `<p>${info.description}</p>` : ''}
                <h3>Endpoints</h3>
            `;

      const sortedPaths = Object.keys(paths).sort();
      for (const path of sortedPaths) {
        const methods = paths[path];
        for (const method of ['get', 'post', 'put', 'patch', 'delete']) {
          if (methods[method]) {
            const op = methods[method];
            html += `
                            <div class="endpoint">
                                <span class="method method-${method}">${method.toUpperCase()}</span>
                                <span class="path">${path}</span>
                                ${op.summary ? `<br><small>${op.summary}</small>` : ''}
                            </div>
                        `;
          }
        }
      }

      html += `
                <h3>Raw Specification</h3>
                <pre>${JSON.stringify(spec, null, 2)}</pre>
            `;

      container.innerHTML = html;
    }
  }

  // Register the custom element
  if (!customElements.get('elements-api')) {
    customElements.define('elements-api', ElementsAPI);
  }

  // Log that Elements is loaded (for debugging)
  console.log('Stoplight Elements placeholder loaded');
})();
